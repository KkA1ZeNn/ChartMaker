<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <title>Document</title>
   <style>
      .settingBar {
         width: 100%;
         height: 7vh;
         display: flex;
         align-items: center;
         justify-content: flex-start;
         margin-bottom: 10px;
      }

      #options {
         width: auto;
         height: 25px;
         margin-left: 20px;
         display: flex;
         align-items: center;
         justify-content: flex-start;
      }

      #method {
         width: 130px;
      }

      #generationCount {
         width: 30px;
      }

      #generate {
         margin-left: 20px;
      }

      label {
         margin: 0px 10px 0px 20px;
      }

      #workspace {
         width: 100%;
         height: 90vh;
         display: flex;
         align-items: center;
         justify-content: flex-start;
      }

      #generatedValues {
         width: 6%;
         height: 100%;
         border: 2px solid black;
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: space-between;
         margin-right: 20px;
      }

      #description {
         width: 100%;
         height: 12%;
         border-bottom: 2px solid black;
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: space-between;
      }

      #description h4 {
         width: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
         height: 50%;
         margin: 0;
         border-bottom: 2px solid black;
         box-sizing: border-box;
      }

      #KX {
         height: 50%;
         width: 100%;
         display: flex;
         align-items: center;
         justify-content: space-around;
      }

      #KX h5 {
         margin: 0;
         width: 50%;
         height: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
      }

      #KX h5:first-child {
         border-right: 2px solid black;
      }

      #values {
         width: 100%;
         height: 88%;
         overflow-y: auto;
      }

      .valueRow {
         height: 7%;
         width: 100%;
         display: flex;
         align-items: center;
         justify-content: space-around;
         border-bottom: 2px solid gray;
         box-sizing: border-box;
      }

      .valueRow h5 {
         margin: 0;
         width: 50%;
         height: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
      }

      .valueRow h5:first-child {
         border-right: 2px solid gray;
      }

      #graphics {
         width: 80%;
         height: 100%;
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: space-between;
      }

      .graphicsRow {
         width: 100%;
         height: 50%;
         display: flex;
         align-items: center;
         justify-content: space-between;
      }

      .graph {
         width: 50%;
         height: 100%;
      }

      #chartdiv {
         border: 2px solid black;
      }

      #values::-webkit-scrollbar {
         display: none;
      }

   </style>
</head>
<body>
   <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
   <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
   <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
   <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
   <script src="https://cdn.amcharts.com/lib/5/locales/de_DE.js"></script>
   <script src="https://cdn.amcharts.com/lib/5/geodata/germanyLow.js"></script>
   <script src="https://cdn.amcharts.com/lib/5/fonts/notosans-sc.js"></script>


   <div class="settingBar">
      <input name="method" list="methods" id = "method" placeholder="Метод генерации">
      <datalist id="methods">
         <option value="1.1 Бернулли"></option>
      </datalist>
      <label for="generationCount">Кол-во генер.знач.</label>
      <input name="count of generations" id = "generationCount" value = "100">

      <div id = "options">
         <input name = "option" class = "option" id = "q" placeholder = "Вероятность успеха Q =" type = "text" style="display: none;">
      </div>
      <button id = "generate">Генерация</button>
   </div>

   </div>
   <div id = "workspace">
      <div id = "generatedValues">
         <div id = "description">
            <h4>Выборка</h4>
            <div id = "KX">
               <h5>K</h5>
               <h5>X</h5>
            </div>
         </div>
         <div id = "values"></div>
      </div>
      <div id = "graphics">
         <div class = "graphicsRow">
            <div class = "graph" id = "graph1"></div>
            <div class = "graph" id = "graph2"></div>
         </div>
         <div class = "graphicsRow">
            <div class = "graph" id = "graph3"></div>
            <div class = "graph" id = "graph4"></div>
         </div>
      </div>
   </div>

   <script>
      const generationMethodHadler = document.querySelector('#method');
      const generationMethod = document.querySelector('#method');
      const generateButton = document.querySelector('#generate');
      const generationCount = document.querySelector('#generationCount');
      const generatorOptionQ = document.querySelector('#q');
      const valuesBar = document.querySelector('#values');
      let errorFlag = true;
      let values = [];

      generationMethodHadler.addEventListener('change', () => {
         switch (generationMethod.value) {
            case "1.1 Бернулли":
               generatorOptionQ.style.display = "block";
               errorFlag = false;
               break;
         
            default:
               break;
         }
      })

      generateButton.addEventListener('click', () => {
         if (!errorFlag) {
            valuesBar.innerHTML = ``;
            values = [];
            for (let i = 0; i < generationCount.value; i++) {
               let newValue = bernoulli( parseFloat(generatorOptionQ.value) );
               const valueRow = document.createElement('div');
               valueRow.classList.add("valueRow");
               valueRow.innerHTML = `
                  <h5>${ i + 1 }</h5>
                  <h5>${ newValue }</h5>
               `;
               valuesBar.appendChild(valueRow);
               values.push ( newValue );
            }

            graph1Creator();
            graph2Creator();
         }
      })

      function bernoulli (q) {
         // Проверяем, что q - это число от 0 до 1
         if (typeof q !== "number" || q < 0 || q > 1) {
            throw new Error ("Q должно быть числом от 0 до 1");
         }
         // Генерируем случайное число от 0 до 1
         let random = Math.random ();
         // Сравниваем его с p и возвращаем результат
         return random <= q ? 1 : 0;
      }

      //-------------------------------------------------------------------------
      let root; 
      let root2;
  
      function graph1Creator() {
         // Define data
         let data = [];
         let yAxis;
         let xAxis;
         let chart;
         let maxValue = Math.max.apply(null, values);

         if (root) {
            root.dispose();
         }
         root = am5.Root.new("graph1");
         root.setThemes([
            am5themes_Animated.new(root)
         ]);

         chart = root.container.children.push( 
            am5xy.XYChart.new(root, {
               panY: false,
               wheelY: "zoomX",
            }) 
         );

         for (let i = 0; i < values.length; ++i) {
            data.push({
               K: i + 1,
               X: values[i]
            });
         }

         // Create Y-axis
         yAxis = chart.yAxes.push(
            am5xy.ValueAxis.new(root, {
               extraTooltipPrecision: 1,
               min: 0,
               max: maxValue >= 1 ? maxValue : 1,
               renderer: am5xy.AxisRendererY.new(root, {})
            })
         );

         // Create X-Axis
         xAxis = chart.xAxes.push(
            am5xy.ValueAxis.new(root, {
               extraTooltipPrecision: 1,
               min: 1,
               max: parseInt(generationCount.value),
               renderer: am5xy.AxisRendererX.new(root, {})
            })
         );

         var series = chart.series.push( 
            am5xy.LineSeries.new(root, { 
               name: "Series",
               xAxis: xAxis, 
               yAxis: yAxis, 
               valueYField: "X", 
               valueXField: "K",
               maskBullets: false
            }) 
         );
      
         series.bullets.push(function() {
            return am5.Bullet.new(root, {
               sprite: am5.Circle.new(root, {
                  radius: 5,
                  fill: series.get("fill")
               })
            });
         });
      
         series.strokes.template.set("strokeWidth", 2);
         series.data.setAll(data);
      }
   
      function graph2Creator() {
         // Define data
         let data = [];
         let yAxis;
         let xAxis;
         let chart;
         let maxValue = 0;

         if (root2) {
            root2.dispose();
         }
         root2 = am5.Root.new("graph2");
         root2.setThemes([
            am5themes_Animated.new(root2)
         ]);

         chart = root2.container.children.push( 
            am5xy.XYChart.new(root2, {
               panY: false,
               wheelY: "zoomX",
               layout: root.verticalLayout
            }) 
         );

         let temp = countOccurrences(values);
         for (key in temp) {
            maxValue = Math.max(maxValue, temp[key]);
            data.push({
               "number": parseInt(key),
               "value": temp[key]
            });
         }

         data.push({
               "number": 5,
               "value": 37
            });
            data.push({
               "number": 6,
               "value": 100
            });
            data.push({
               "number": 7,
               "value": 37
            });
            data.push({
               "number": 8,
               "value": 100
            });
            data.push({
               "number": 9,
               "value": 37
            });
            data.push({
               "number": 10,
               "value": 100
            });

         // Create Y-axis
         yAxis = chart.yAxes.push(
            am5xy.ValueAxis.new(root2, {
               extraTooltipPrecision: 1,
               min: 0,
               max: maxValue >= 1 ? maxValue : 1,
               renderer: am5xy.AxisRendererY.new(root2, {})
            })
         );

         // Create X-Axis
         xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root2, {
            categoryField: "number",
            renderer: am5xy.AxisRendererX.new(root2, {
               cellStartLocation: 0.1,
               cellEndLocation: 0.9
            }),
            tooltip: am5.Tooltip.new(root2, {})
         }));

         xAxis.data.setAll(data);

         var series = chart.series.push( 
            am5xy.ColumnSeries.new(root2, { 
               name: "Series",
               xAxis: xAxis, 
               yAxis: yAxis, 
               valueYField: "value", 
               categoryXField: "number"
            }) 
         );
      
         yAxis.get("renderer").labels.template.set("fill", series.get("fill"));

         series.columns.template.setAll({
            tooltipText: "{valueY}",
            width: am5.percent(30),
            tooltipY: 0
         });

         series.data.setAll(data);
      }

      function countOccurrences(arr) {
         return arr.reduce((acc, curr) => {
            acc[curr] ? acc[curr]++ : (acc[curr] = 1);
            return acc;
         }, {});
      }
   </script>
</body>
</html>